<script context="module"></script>

<script>import { onMount } from "svelte";
import ContentVariants from "../../components/content-variants/content-variants.svelte";
import { filterAttrs } from "../helpers.js";
import { setAttrs } from "../helpers.js";
import { fetchSymbolContent } from "./symbol.helpers.js";
export let js;
export let attributes = undefined;
export let symbol = undefined;
export let dynamic = undefined;
export let builderContext;
export let builderComponents;
function setContent() {
    if (contentToUse)
        return;
    fetchSymbolContent({
        symbol: symbol,
        builderContextValue: $builderContext,
    }).then((newContent) => {
        if (newContent) {
            contentToUse = newContent;
        }
    });
}
$: className = () => {
    return [
        ...[attributes.class],
        "builder-symbol",
        symbol?.inline ? "builder-inline-symbol" : undefined,
        symbol?.dynamic || dynamic ? "builder-dynamic-symbol" : undefined,
    ]
        .filter(Boolean)
        .join(" ");
};
let contentToUse = symbol?.content;
onMount(() => {
    setContent();
});
function onUpdateFn_0(..._args) {
    setContent();
}
$: onUpdateFn_0(...[symbol]);
</script>

<div
  {...filterAttrs(attributes, "on:", false)}
  {...{}}
  class={className()}
  use:setAttrs={filterAttrs(attributes, "on:", true)}
>
  <ContentVariants
    __isNestedRender={true}
    apiVersion={$builderContext.apiVersion}
    apiKey={$builderContext.apiKey}
    context={$builderContext.context}
    customComponents={Object.values(builderComponents)}
    data={{
      ...symbol?.data,
      ...$builderContext.localState,
      ...contentToUse?.data?.state,
    }}
    model={symbol?.model}
    content={contentToUse}
  />
</div>