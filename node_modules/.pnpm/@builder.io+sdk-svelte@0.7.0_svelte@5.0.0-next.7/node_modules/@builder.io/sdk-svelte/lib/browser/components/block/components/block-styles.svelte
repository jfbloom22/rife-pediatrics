<script context="module"></script>

<script>import { getMaxWidthQueryForSize, getSizesForBreakpoints, } from "../../../constants/device-sizes.js";
import { TARGET } from "../../../constants/target.js";
import { getProcessedBlock } from "../../../functions/get-processed-block.js";
import { createCssClass } from "../../../helpers/css.js";
import { checkIsDefined } from "../../../helpers/nullable.js";
import InlinedStyles from "../../inlined-styles.svelte";
export let block;
export let context;
$: canShowBlock = () => {
    const processedBlock = getProcessedBlock({
        block: block,
        localState: context.localState,
        rootState: context.rootState,
        rootSetState: context.rootSetState,
        context: context.context,
        shouldEvaluateBindings: true,
    });
    // only render styles for blocks that are visible
    if (checkIsDefined(processedBlock.hide)) {
        return !processedBlock.hide;
    }
    if (checkIsDefined(processedBlock.show)) {
        return processedBlock.show;
    }
    return true;
};
$: css = () => {
    const processedBlock = getProcessedBlock({
        block: block,
        localState: context.localState,
        rootState: context.rootState,
        rootSetState: context.rootSetState,
        context: context.context,
        shouldEvaluateBindings: true,
    });
    const styles = processedBlock.responsiveStyles;
    const content = context.content;
    const sizesWithUpdatedBreakpoints = getSizesForBreakpoints(content?.meta?.breakpoints || {});
    const largeStyles = styles?.large;
    const mediumStyles = styles?.medium;
    const smallStyles = styles?.small;
    const className = processedBlock.id;
    if (!className) {
        return "";
    }
    const largeStylesClass = largeStyles
        ? createCssClass({
            className,
            styles: largeStyles,
        })
        : "";
    const mediumStylesClass = mediumStyles
        ? createCssClass({
            className,
            styles: mediumStyles,
            mediaQuery: getMaxWidthQueryForSize("medium", sizesWithUpdatedBreakpoints),
        })
        : "";
    const smallStylesClass = smallStyles
        ? createCssClass({
            className,
            styles: smallStyles,
            mediaQuery: getMaxWidthQueryForSize("small", sizesWithUpdatedBreakpoints),
        })
        : "";
    return [largeStylesClass, mediumStylesClass, smallStylesClass].join(" ");
};
</script>

{#if TARGET !== "reactNative" && css() && canShowBlock()}
  <InlinedStyles styles={css()} />
{/if}